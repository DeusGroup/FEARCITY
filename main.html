<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fear City Cycles - Queens NYC Custom Motorcycles</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Fix oversized product cards */
        .product-card {
            padding: 20px !important;
            margin-bottom: 0 !important;
        }
        
        .product-card img {
            width: 100%;
            height: 200px !important;
            object-fit: cover;
            margin-bottom: 15px;
        }
        
        .product-card h3 {
            font-size: 1.3em !important;
            margin-bottom: 10px !important;
        }
        
        .product-card p {
            font-size: 0.95em;
            margin-bottom: 15px !important;
        }
        
        .price {
            font-size: 1.3em !important;
            margin-bottom: 15px !important;
        }
        
        /* Product details inline functionality */
        .product-details {
            display: none;
            background: #111;
            border: 2px solid #8B0000;
            padding: 15px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .product-details.active {
            display: block;
        }
        
        .product-details h4 {
            color: #8B0000;
            margin: 0 0 10px 0;
            font-family: 'Orbitron', monospace;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1em;
        }
        
        .product-details ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .product-details li {
            padding: 5px 0;
            border-bottom: 1px solid #333;
            color: #ccc;
            font-size: 0.85em;
        }
        
        .product-details li:last-child {
            border-bottom: none;
        }
        
        /* Simple Hero - No Movie */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.6), rgba(139,0,0,0.3)), url('assets/images/hero-bg.jpg') center/cover;
            min-height: 60vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .hero-content {
            color: white;
            max-width: 800px;
            padding: 0 20px;
        }
        
        .hero-content h1 {
            font-size: 3.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 20px;
        }
        
        .hero-content p {
            font-size: 1.3rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            margin-bottom: 30px;
        }
        
        .cta-btn {
            display: inline-block;
            background: #8B0000;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 2px solid #8B0000;
            transition: all 0.3s ease;
        }
        
        .cta-btn:hover {
            background: #cc0000;
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .hero-content h1 {
                font-size: 2.5rem;
            }
            
            .hero-content p {
                font-size: 1.1rem;
            }
        }
        
        /* Product buttons layout */
        .product-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .view-btn, .add-btn {
            padding: 10px 20px !important;
            font-size: 0.9em !important;
            font-family: var(--font-body);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border: 2px solid;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        .add-btn {
            background: #333;
            color: white;
            border-color: #333;
        }
        
        .add-btn:hover {
            background: #555;
            border-color: #555;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="assets/images/fear-city-logo-small.jpg" alt="Fear City Cycles">
                <span class="logo-text">Fear City Cycles</span>
            </a>
            <ul class="nav-menu">
                <li><a href="#bikes">Bikes</a></li>
                <li><a href="#gear">Gear</a></li>
                <li><a href="culture.html">Culture</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="#contact">Contact</a></li>
                <li><a href="cart/" class="cart-link">Cart (<span id="cart-count">0</span>)</a></li>
            </ul>
            <div class="mobile-menu-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <section class="hero">
        <div class="hero-content">
            <h1>Lean Mean Built in Queens</h1>
            <p>These aren't garage queens - they're street fighters.</p>
            <a href="#bikes" class="cta-btn">View Our Rides</a>
        </div>
    </section>

    <section class="products" id="bikes">
        <h2>Custom Motorcycles</h2>
        <div class="product-grid">
            <!-- Motorcycles will be loaded dynamically from API -->
        </div>
    </section>

    <section class="products" id="gear">
        <h2>Gear & Apparel</h2>
        <div class="product-grid">
            <!-- Gear products will be loaded dynamically from API -->
        </div>
    </section>

    <section id="contact">
        <h2>Contact</h2>
        <p>Queens, NYC<br>
        Email: info@fearcitycycles.com<br>
        Phone: Call if you know</p>
    </section>

    <footer>
        <p>&copy; 2025 Fear City Cycles - Born in Queens. Built for Battle.</p>
    </footer>

    <!-- Emergency cart conflict prevention -->
    <script>
        // Execute immediately to prevent cart conflicts
        window.addEventListener('error', function(e) {
            if (e.message && e.message.includes('redeclaration of let cart')) {
                console.log('INTERCEPTED: Cart redeclaration error prevented');
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        });
        
        // Override any existing cart declarations
        try {
            Object.defineProperty(window, 'cart', {
                configurable: true,
                set: function(value) {
                    console.log('Cart assignment intercepted');
                    this._cart = value;
                },
                get: function() {
                    return this._cart;
                }
            });
        } catch (e) {
            console.log('Cart property override failed:', e);
        }
    </script>
    
    <script>
        // Force clear service worker cache to remove main.js
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                    console.log('Service worker unregistered');
                }
            });
            
            // Clear all caches
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    names.forEach(function(name) {
                        caches.delete(name);
                        console.log('Cache deleted:', name);
                    });
                });
            }
        }
        
        // Aggressively block any attempt to load main.js
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(this, tagName);
            if (tagName.toLowerCase() === 'script') {
                const originalSetAttribute = element.setAttribute;
                element.setAttribute = function(name, value) {
                    if (name === 'src' && value && value.includes('main.js')) {
                        console.log('BLOCKED: Attempt to load main.js via createElement');
                        return;
                    }
                    return originalSetAttribute.call(this, name, value);
                };
            }
            return element;
        };
        
        // Block existing script attempts
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.tagName === 'SCRIPT' && node.src && node.src.includes('main.js')) {
                        console.log('BLOCKED: main.js script tag removed');
                        node.remove();
                    }
                });
            });
        });
        observer.observe(document.head, { childList: true });
        observer.observe(document.body, { childList: true });
        
        // Remove any existing main.js scripts
        document.querySelectorAll('script[src*="main.js"]').forEach(script => {
            console.log('REMOVED: Existing main.js script');
            script.remove();
        });
        
        (function() {
        // Prevent cart variable conflicts
        try {
            if (typeof cart !== 'undefined') {
                // Rename existing cart to avoid conflicts
                window.oldCart = cart;
                delete window.cart;
            }
        } catch (e) {
            // Ignore any errors from cart access
        }
        
        // Debug: Check for script conflicts
        console.log('Main.html inline script loading...');
        console.log('Cart conflict prevention applied');
        
        // Cart functionality is handled by ShoppingCart class in main.js
        function updateCartCount() {
            // This will be handled by the ShoppingCart class
            if (window.fearCityCart) {
                const count = window.fearCityCart.getItemCount();
                document.getElementById('cart-count').textContent = count;
            }
        }
        
        function addToCart(name, price) {
            // Use the global cart instance
            if (window.fearCityCart) {
                window.fearCityCart.addItem({ name: name, price: price, id: name.toLowerCase().replace(/\s+/g, '-') });
            }
        }
        
        function toggleDetails(button) {
            // Close all other open details first
            const allDetails = document.querySelectorAll('.product-details.active');
            allDetails.forEach(detail => {
                if (detail !== button.parentNode.nextElementSibling) {
                    detail.classList.remove('active');
                    const otherButton = detail.previousElementSibling.querySelector('.view-btn');
                    if (otherButton) otherButton.textContent = 'View Details';
                }
            });
            
            // Toggle current details
            const details = button.parentNode.nextElementSibling;
            if (details.classList.contains('active')) {
                details.classList.remove('active');
                button.textContent = 'View Details';
            } else {
                details.classList.add('active');
                button.textContent = 'Hide Details';
            }
        }
        
        // Mobile menu functionality
        const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
        const navMenu = document.querySelector('.nav-menu');
        
        if (mobileMenuToggle && navMenu) {
            mobileMenuToggle.addEventListener('click', function() {
                navMenu.classList.toggle('active');
                this.classList.toggle('active');
            });
        }
        
        // Close mobile menu when clicking on nav links
        const navLinks = document.querySelectorAll('.nav-menu a');
        navLinks.forEach(link => {
            link.addEventListener('click', function() {
                if (navMenu && navMenu.classList.contains('active')) {
                    navMenu.classList.remove('active');
                    if (mobileMenuToggle) mobileMenuToggle.classList.remove('active');
                }
            });
        });
        
        // Simple cart functionality (replacing main.js to avoid conflicts)
        window.fearCityCart = {
            items: JSON.parse(localStorage.getItem('fearCityCart')) || [],
            
            addItem: function(product) {
                const existing = this.items.find(item => item.id === product.id);
                if (existing) {
                    existing.quantity += 1;
                } else {
                    this.items.push({
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        image: product.image,
                        quantity: 1
                    });
                }
                this.saveCart();
                this.updateDisplay();
                alert(product.name + ' added to cart!');
            },
            
            getItemCount: function() {
                return this.items.reduce((count, item) => count + item.quantity, 0);
            },
            
            saveCart: function() {
                localStorage.setItem('fearCityCart', JSON.stringify(this.items));
            },
            
            updateDisplay: function() {
                const count = this.getItemCount();
                document.getElementById('cart-count').textContent = count;
            }
        };
        
        // Initialize on load
        setTimeout(() => {
            updateCartCount();
            window.fearCityCart.updateDisplay();
        }, 100);
        
        })(); // End of IIFE
    </script>
    
    <!-- Skip external scripts due to cache conflicts - implement hero movie inline -->
    
    <!-- Inline Hero Movie and Product Loading -->
    <script>
        
        // Inline API for products
        function createMockAPI() {
            const mockProducts = [
                { id: 'street-reaper', name: 'Street Reaper', price: 24500, images: ['/assets/images/bike-street-reaper.jpg'], description: 'Pure aggression on two wheels.', category: { slug: 'motorcycles' } },
                { id: 'queens-crusher', name: 'Queens Crusher', price: 26750, images: ['/assets/images/bike-queens-crusher.jpg'], description: 'Born in Queens, built for battle.', category: { slug: 'motorcycles' } },
                { id: 'death-rider', name: 'Death Rider', price: 29500, images: ['/assets/images/bike-death-rider.jpg'], description: 'When subtlety is not an option.', category: { slug: 'motorcycles' } },
                { id: 'reaper-gloves', name: 'Reaper Riding Gloves', price: 89, images: ['/assets/images/gloves-reaper-riding.jpg'], description: 'Professional-grade riding gloves.', category: { slug: 'gear' } },
                { id: 'fear-city-jacket', name: 'Fear City Leather Jacket', price: 395, images: ['/assets/images/jacket-fear-city.jpg'], description: 'Premium leather jacket.', category: { slug: 'gear' } },
                { id: 'queens-skull-tee', name: 'Queens Skull Tee', price: 35, images: ['/assets/images/tee-queens-skull.jpg'], description: 'Rep Queens with this hardcore design.', category: { slug: 'gear' } }
            ];
            
            return {
                fetchProducts: function(params = {}) {
                    return new Promise(resolve => {
                        let filtered = mockProducts;
                        if (params.category) {
                            filtered = mockProducts.filter(p => p.category.slug === params.category);
                        }
                        setTimeout(() => resolve({ products: filtered }), 100);
                    });
                }
            };
        }
        
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Initializing page...');
            
            
            // Initialize products
            const api = createMockAPI();
            console.log('Loading products for main page...');
            
            try {
                // Initialize API (should be available from script tag)
                console.log('window.FearCityAPI available:', typeof window.FearCityAPI);
                let fearCityAPI;
                
                if (window.FearCityAPI) {
                    fearCityAPI = new window.FearCityAPI();
                } else {
                    // Fallback to module import
                    const apiModule = await import('./assets/js/api.js');
                    fearCityAPI = new apiModule.FearCityAPI();
                }
                
                // Load bikes
                console.log('Fetching motorcycles...');
                const bikesResponse = await fearCityAPI.fetchProducts({ category: 'motorcycles' });
                console.log('Bikes response:', bikesResponse);
                
                if (bikesResponse && bikesResponse.products) {
                    const bikesGrid = document.querySelector('#bikes .product-grid');
                    if (bikesGrid) {
                        bikesGrid.innerHTML = '';
                        bikesResponse.products.forEach(bike => {
                            const bikeCard = createProductCard(bike);
                            bikesGrid.appendChild(bikeCard);
                        });
                        console.log('Loaded', bikesResponse.products.length, 'bikes');
                    }
                }
                
                // Load gear
                console.log('Fetching gear...');
                const gearResponse = await fearCityAPI.fetchProducts({ category: 'gear' });
                console.log('Gear response:', gearResponse);
                
                if (gearResponse && gearResponse.products) {
                    const gearGrid = document.querySelector('#gear .product-grid');
                    if (gearGrid) {
                        gearGrid.innerHTML = '';
                        gearResponse.products.forEach(gear => {
                            const gearCard = createProductCard(gear);
                            gearGrid.appendChild(gearCard);
                        });
                        console.log('Loaded', gearResponse.products.length, 'gear items');
                    }
                }
                
            } catch (error) {
                console.error('Error loading products:', error);
            }
        });
        
        // Create product card HTML
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.innerHTML = `
                <img src="${product.images[0]}" alt="${product.name}" loading="lazy">
                <h3>${product.name}</h3>
                <p class="price">$${product.price.toLocaleString()}</p>
                <p>${product.description}</p>
                <div class="product-buttons">
                    <button class="view-btn" onclick="window.location.href='${product.category.slug}/${product.slug}.html'">View Details</button>
                    <button class="add-btn" onclick="window.fearCityCart && window.fearCityCart.addItem('${product.id}', '${product.name}', ${product.price}, '${product.images[0]}')">Add to Cart</button>
                </div>
            `;
            return card;
        }
        
        
    </script>
</body>
</html>